---
title: "Docker로 홈서버 구축하기 - Docker란 무엇인가?"
category: "홈서버"
author: kuper0201
tags: ['#server']
date: 2022-03-02
slug: server1
thumbnail: cover.jpg
draft: true
---

## 서론

&nbsp;&nbsp;처음 홈서버를 구축했을 때는 남는 사무용 컴퓨터에 리눅스를 설치해 Apache, 메일 서버, FTP 서버 등을 구축해 사용하였습니다. 하지만 배포판이 업데이트되거나 사용하는 응용프로그램이 업데이트 될 때마다 크고 작은 문제가 생기게 되었고 문제가 발생하는 부분을 찾아서 해결하거나 잘못 건드린 부분으로 인해 아예 운영체제를 처음부터 재설치 해야 하는 경우가 생겼습니다. 이를 해결하기 위해 가장 안정적이고 잘 설정된 환경을 CloneZilla등의 백업 솔루션을 이용해 디스크 복제를 통해 백업을 해 두고 문제가 발생 할 때 마다 복원을 하는 방식으로 서버를 운용하고 있었습니다.

하지만 이는 근본적인 해결책이 아닐 뿐더러 OS가 업데이트될 때 마다 클린설치를 다시하고 새로운 클론을 다시 만들어야 한다는 문제가 있었습니다. 이는 꽤 오래 걸리고 귀찮은 작업이므로 서버 관리에 소홀해지는 결과를 낳았습니다.

## 아이디어

&nbsp;&nbsp;따라서 Host OS에 비교적 자유로운 VirtualBox, VM Ware 등의 가상화 솔루션을 이용해 사용하는 서비스를 분산시키면 어떨까? 라는 생각을 하게 되었습니다.

서비스를 분산시키면 하나의 서비스에 문제가 생겨도 해당 VM만 수정하면 되기 때문에 무관한 다른 서비스들까지 죽는 경우는 생기지 않을 것이라는 생각이었습니다. 하지만 당시에 필자가 사용하던 서버는 일반 사무용 데스크톱에 리눅스를 설치해 운용하였기 때문에 성능이 그다지 좋지 않았기 때문에 VirtualBox 등의 가상화 솔루션으로는 성능적 한계가 느껴졌습니다.

Guest OS로 데스크톱 환경 없이 CLI만으로 리눅스를 설치를 해보기도 하고 절반 이상의 자원을 VM에 할당하는 등 최대한의 성능을 사용하기 위한 노력을 해 보았지만 물리적인 PC의 성능이 낮았기 때문에 도저히 쓸만한 성능이 나오지 않았습니다. 그렇게 성능 문제로 인해 가상화는 포기 하고 주먹구구식으로 서버를 운영하던 중 Docker라는 솔루션을 알게 되었고 성능 또한 꽤 괜찮게 나온다는 코멘트를 보았습니다.

실제로 서버에 설치해 사용해 보니 정말로 다른 가상화 솔루션과는 비교가 되지 않을 정도로 높은 성능으로 사용하던 모든 서비스를 구동할 수 있었습니다. 이에 저는 도대체 다른 가상화 솔루션들과 무엇이 다르길래 성능이 좋은 것인가? 라는 궁금증이 생기게 되었고 자료를 찾아보았습니다.

## Docker의 장점

&nbsp;&nbsp;결론을 먼저 말하자면 Docker에서는 Guest OS가 필요 없기 때문에 성능이 더 좋은 것이라고 합니다. 여기서 Guest OS 없이 어떻게 가상화를 하는가? 라는 의문이 생기게 되는데 이에 대한 대답은 간단합니다.

프로세스가 Host OS의 커널과 자원을 공유해서 사용하면 됩니다. 기존의 가상화 솔루션에서는 OS 자체를 가상화 하고 그 위에서 프로세스가 구동되기 때문에<br/>
`Guest OS를 구동할 자원` + `Guest OS에서 실행되는 프로세스에 필요한 자원`을 할당해 주어야 했습니다.

하지만 Docker에서는 프로세스가 Guest OS 없이 Host OS의 커널과 자원을 직접 사용하므로 Guest OS를 구동할 자원의 할당이 필요 없어집니다. 따라서 Guest OS에서 실행되는 프로세스에 필요한 자원만을 할당해서 적은 양의 오버헤드로 구동 할 수 있습니다.

단순하게 이야기 하자면 기존의 가상화 솔루션들은 OS 자체를 가상화 하지만 Docker에서는 프로세스를 가상화 하므로 자원이 비교적 적게 사용된다 라는 의미입니다.

또한 가상화된 프로세스들은 격리 되어있기 때문에 한 서비스가 다운되었다고 해서 다른 서비스에 영향을 주지 못합니다. 이 때 다운된 프로세스만 빠르게 수정해서 재배포 하면 되기 때문에 편리하고 가용성이 높습니다.

## Docker의 단점

&nbsp;&nbsp;상기한 장점들을 보면 Docker와 VM중 당연히 Docker를 지향해야 할 것으로 보입니다. 하지만 Docker에도 단점은 존재합니다.

`1. Host OS의 자원을 공유하므로 VM에 비해 Host OS에 영향을 줄 가능성이 크다.`<br/>
`2. Host OS의 자원을 공유하므로 가상화하는 프로세스 또한 Host OS의 커널에서 구동 가능해야 한다.`<br/>
`3. Docker 또한 가상화이기 때문에 Host OS에서 직접 구동하는 것 보다는 오버헤드가 크다.`

## 컨테이너와 이미지?

&nbsp;&nbsp;가상화 솔루션에서 하나의 가상 OS를 VM(Virtual Machine)이라고 하듯 Docker에서는 가상화하는 프로세스를 컨테이너(Container)라고 합니다. VM에는 OS/라이브러리/프로세스 가 포함되어 있지만 컨테이너에는 라이브러리/프로세스 가 포함되어 있습니다.

VM을 생성하기 위해 OS 설치와 App의 설치가 필요합니다. Docker에서는 사용자들이 커뮤니티에 Apache, NGINX 등 자주 사용되는 App을 실행하기 쉽게 미리 제작해 두었습니다. 이렇게 App을 실행하기 위한 라이브러리/도구 등을 포함한 미리 제작된 템플릿을 이미지(Image)라고 합니다.

물론 미리 제작된 이미지 말고도 본인이 직접 이미지를 생성해서 사용할 수 있고 커뮤니티에 공유 또한 가능합니다.